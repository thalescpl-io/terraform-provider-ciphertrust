---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_hsm_root_of_trust_setup Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  
---

# ciphertrust_hsm_root_of_trust_setup (Resource)

A ciphertrust_hsm_root_of_trust_setup resource performs the initial setup of the system to use HSM. Supported HSM types are luna, lunatct and lunapci.

A reset operation is required. This means that all existing data in the system will be wiped and CipherTrust Manager will be started from a clean slate

This resource is applicable to CipherTrust Manager only.

## Example Usage

```terraform
# HSM root of trust setup of type luna
resource "ciphertrust_hsm_root_of_trust_setup" "cm_hsm_rot_setup" {
  type         = "luna"
  conn_info = {
    partition_name     = "kylo-partition"
    partition_password = "sOmeP@ssword"
  }
  initial_config = {
    host           = "172.20.32.11"
    serial         = "1234"
    server-cert    = "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"
    client-cert    = "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"
    client-cert-key = "-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
  }
  reset = true
  delay = 5
}
```

```terraform
# HSM root of trust setup of type luna using the STC protocol
resource "ciphertrust_hsm_root_of_trust_setup" "cm_hsm_rot_setup" {
  type         = "luna"
  conn_info = {
    partition_name     = "kylo-partition"
    partition_password = "sOmeP@ssword"
  }
  initial_config = {
    host           = "172.20.32.11"
    serial         = "1234"
    server-cert    = "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"
    stc-par-identity= "VGhpcyBpcyB0aGUgZXhhbXB...sZSBvZiBzdGMtcGFyLWlkZW50aXR5"
  }
  reset = true
  delay = 5
}
```

```terraform
# HSM root of trust setup of type lunapci
resource "ciphertrust_hsm_root_of_trust_setup" "cm_hsm_rot_setup" {
  type         = "lunapci"
  conn_info = {
    partition_name     = "kylo-partition"
    partition_password = "sOmeP@ssword"
  }
  reset = true
  delay = 5
}
```

```terraform
# HSM root of trust setup of type lunatct
resource "ciphertrust_hsm_root_of_trust_setup" "cm_hsm_rot_setup" {
  type         = "lunatct"
  conn_info = {
    partition_name     = "kylo-partition"
    partition_password = "sOmeP@ssword"
  }
  initial_config = {
    host           = "172.20.32.11"
    serial         = "1234"
    server-cert    = "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"
    client-cert    = "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"
    client-cert-key = "-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
  }
  reset = true
  delay = 5
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `conn_info` (Map of String) Connection information for initial HSM to setup in key-value format. The expected content of this parameter depends on the specific HSM type used.

   - For Luna Network HSM (including TCT) and Luna PCIe, the required attributes are:

     - "partition_name"  
        The name of the HSM partition to use.

     - "partition_password"  
        The password of the initial partition to use. This will be the Crypto Officer role password or challenge secret. Luna documentation describes in detail how to set up a password for an application to access a partition.  
        If you plan to use multiple Luna HSMs operating in high-availability (HA) mode, all HSMs must have the same password.

   Luna Network/PCIe HSM (including TCT) example:

           { 
             partition_name     = "kylo-partition"
             partition_password = "sOmeP@ssword"
           }

- `type` (String) Type of HSM server to setup, supported types are "luna", "lunapci", and "lunatct". "luna" refers to the Luna Network HSM version 5, 6, or 7, "lunapci" refers to the embedded Luna PCIe HSM, and "lunatct" refers to the Luna T-Series HSMs.

### Optional

- `delay` (Number) Delay in seconds before reset, defaults to 5 seconds


- `initial_config` (Map of String) A map of key-value pairs representing the initial configuration for the HSM setup. The expected content of this parameter depends on the specific HSM type used.

   - For Luna Network HSM (including TCT) the required attributes are:
     - "host"
        IP or hostname
     - "serial"
        Serial number of the partition to use
     - "server-cert"
        Server certificate in PEM format. Line breaks in PEM string must be replaced with "\n".
        For externally signed server certs (not supported on TCT), append all certificates in the signing chain.
     - "client-cert"
        Client certificate in PEM format. Line breaks in PEM string must be replaced with "\n".
     - "client-cert-key"
        Client private key in PEM format. Line breaks in PEM string must be replaced with "\n".

   - For Luna Network HSM using the STC protocol, the required attributes are:
     - "host"
       IP or hostname
     - "serial"
        Serial number of the partition to use
     - "server-cert"
        Server certificate in PEM format. Line breaks in PEM string must be replaced with "\n".
     - "stc-par-identity"
        STC partition identity encoded as a base64 string without line breaks (base64 -w0 1234567890123.pid)
        Note that this instance's STC client identity (see /system/hsm/clients/stcidentity) must be registered externally prior to invoking this API.

   - Luna PCIe HSM (including TCT) does not require any attribute. initialConfig shall be omitted.

   Luna Network HSM (including TCT) example:

         {
             "host": "172.20.32.11",
             "serial": "1234",
             "server-cert": "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----",
             "client-cert": "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----",
             "client-cert-key": "-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
        }

   Note: JSON does not allow line-breaks, it needs to be replaced with \n. Use "sed -z 's/\n/\\n/g' cert-file.pem" command to format the certificate.


- `reset` (Boolean) If true CipherTrust Manager will perform a reset operation after the initial HSM setup.

  Currently, a reset is required for this operation to succeed.

  WARNING - Reset is a destructive operation and will wipe all data in the CipherTrust Manager.

### Read-Only

- `config` (Map of String) Configuration of the HSM.
- `id` (String) The ID of this resource.
- `sub_type` (String) The subtype of the HSM setup.
